<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>SPb Inside – Тур</title>
  <meta name="description" content="Описание выбранной экскурсии" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Стили -->
  <link rel="stylesheet" href="css/style.css" />
  <!-- Font Awesome (иконки) -->
  <script src="https://kit.fontawesome.com/2260ab7231.js" crossorigin="anonymous"></script>
</head>
<body>
  <!-- Затемняющая подложка -->
  <div class="site-overlay" id="siteOverlay"></div>

  <!-- Кнопка "Вверх" -->
  <button class="scroll-top" id="scrollTopBtn" aria-label="Прокрутить вверх">↑</button>

  <!-- Шапка -->
  <header class="header">
    <div class="header__logo" id="logo">SPb Inside</div>
    <div class="header__social">
      <a href="#" aria-label="WhatsApp" class="header-social-link">
        <i class="fab fa-whatsapp"></i>
      </a>
      <a href="#" aria-label="Telegram" class="header-social-link">
        <i class="fab fa-telegram-plane"></i>
      </a>
      <a href="#" aria-label="Instagram" class="header-social-link">
        <i class="fab fa-instagram"></i>
      </a>
    </div>
    <button class="header__burger" id="burgerBtn" aria-label="Открыть меню">
      <span></span>
      <span></span>
      <span></span>
    </button>
    <nav class="header__nav" id="mainNav">
      <ul class="nav__list">
        <li class="nav__item"><a class="nav__link" href="index.html#hero">Главная</a></li>
        <li class="nav__item"><a class="nav__link" href="index.html#faq">FAQ</a></li>
        <li class="nav__item"><a class="nav__link" href="index.html#tours">Экскурсии</a></li>
        <li class="nav__item"><a class="nav__link" href="index.html#about">О компании</a></li>
      </ul>
    </nav>
  </header>
  <div class="header-offset"></div>
  
  <!-- Основная секция для конкретной экскурсии -->
  <main class="main" id="tourMain">
    <section class="tour-page" id="tourSection">
      <div class="tour-page__carousel">
          <button class="carousel__btn carousel__btn--prev" id="prevSlide" aria-label="Предыдущее фото">❮</button>
          <div class="carousel__container">
              <img src="${mainImage}" alt="${foundTour.title}" id="carouselImage" />
          </div>
          <button class="carousel__btn carousel__btn--next" id="nextSlide" aria-label="Следующее фото">❯</button>
          <div class="carousel__dots" id="carouselDots"></div>
      </div>
    </section>
  </main>

  <!-- Футер (как на index.html) -->
  <footer class="footer" id="contacts">
    <div class="footer__container">
      <div class="footer__info">
        <h3 class="footer__title">SPb Inside</h3>
        <p>© 2025, Все права защищены.</p>
        <p id="footerAdditionalText"></p>
      </div>
      <div class="footer__contact">
        <h3 class="footer__title">Контакты</h3>
        <p><i class="fas fa-phone-alt"></i> <a href="tel:+79991234567" id="footerPhone">+7 (999) 123-45-67</a></p>
        <p><i class="fas fa-envelope"></i> <a href="mailto:info@spbinside.ru" id="footerEmail">info@spbinside.ru</a></p>
        <p><i class="fas fa-map-marker-alt"></i> <span id="footerAddress">Невский проспект, д. 10, Санкт-Петербург</span></p>
      </div>
      <div class="footer__social">
        <h3 class="footer__title">Мы в соцсетях</h3>
        <div class="social">
          <a href="#" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
          <a href="#" aria-label="Telegram"><i class="fab fa-telegram-plane"></i></a>
          <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Боковая панель (sidebar) бронирования -->
  <div class="sidebar" id="bookingSidebar" role="dialog" aria-labelledby="bookingFormTitle" aria-hidden="true">
    <div class="sidebar__content">
      <button class="sidebar__close" id="sidebarCloseBtn" aria-label="Закрыть панель">×</button>
      <div class="booking-summary">
        <img id="bookingTourImg" alt="Миниатюра тура" />
        <h2 class="booking-summary__title" id="bookingTourTitle">Бронирование</h2>
      </div>
      <form class="booking-form" id="bookingForm">
        <p class="booking-form__subtitle">Оставьте заявку, и наш менеджер свяжется с вами для подтверждения экскурсии.</p>
        <div class="form-group">
          <select id="bookingTourSelect">
            <option value="" disabled selected>Выбрать экскурсию</option>
          </select>
        </div>
        <div class="form-group">
          <select id="bookingTypeSelect">
            <option value="" disabled selected>Выбрать формат</option>
            <option value="Групповая">Групповая</option>
            <option value="Индивидуальная">Индивидуальная</option>
          </select>
        </div>
        <div class="form-group">
          <select id="bookingTimeSelect">
            <option value="12:00">12:00</option>
            <option value="14:00">14:00</option>
            <option value="16:00">16:00</option>
            <option value="18:00">18:00</option>
          </select>
        </div>
        <div class="form-group">
          <input type="date" id="bookingDateField" placeholder="Желаемая дата">
        </div>
        <div class="people-count">
          <label>Взрослые</label>
          <div class="counter">
            <button type="button" class="counter__btn" data-action="decrease" data-target="adultCount">–</button>
            <span id="adultCount">1</span>
            <button type="button" class="counter__btn" data-action="increase" data-target="adultCount">+</button>
          </div>
        </div>
        <div class="people-count">
          <label>Дети 6-10 лет</label>
          <div class="counter">
            <button type="button" class="counter__btn" data-action="decrease" data-target="childCount">–</button>
            <span id="childCount">0</span>
            <button type="button" class="counter__btn" data-action="increase" data-target="childCount">+</button>
          </div>
        </div>
        <div class="total-price">Итого: <span id="totalPrice">0</span> руб.</div>
        <div class="form-group">
          <input type="text" id="bookingNameField" placeholder="Ваше имя">
        </div>
        <div class="form-group">
          <input type="tel" id="bookingPhoneField" placeholder="+7 (999) 999-99-99">
        </div>
        <button class="btn btn--primary" type="submit" id="bookingSubmitBtn">Отправить</button>
      </form>
    </div>
  </div>

  <!-- Подключаем общий script -->
  <script src="js/script.js"></script>
  <script>
    // При загрузке страницы вытащим ID экскурсии из URL
    (function() {
      const urlParams = new URLSearchParams(window.location.search);
      const tourId = urlParams.get('id');
      const tourSection = document.getElementById('tourSection');
      if (!tourId) {
        // Нет ID — выводим ошибку
        tourSection.innerHTML = '<h2 style="text-align:center; margin:50px 0;">Экскурсия не найдена (нет параметра id)</h2>';
        return;
      }

      // Получаем список туров из localStorage
      if (!window.getToursFromStorage) {
        tourSection.innerHTML = '<h2 style="text-align:center; margin:50px 0;">Функции не найдены</h2>';
        return;
      }
      const allTours = window.getToursFromStorage();
      const foundTour = allTours.find(t => t.id === tourId);

      if (!foundTour) {
        tourSection.innerHTML = '<h2 style="text-align:center; margin:50px 0;">Экскурсия не найдена</h2>';
        return;
      }

      // Формируем хлебные крошки
      const crumbs = document.createElement('nav');
      crumbs.className = 'breadcrumbs';
      crumbs.innerHTML = `<a href="index.html">Главная</a> / ${foundTour.title}`;

      // Основной контент
      let mainImage = (foundTour.images && foundTour.images.length)
        ? foundTour.images[0]
        : 'images/placeholder.jpg';

      let html = `
        <div class="tour-page__container">
          <div class="tour-page__carousel">
            <button class="carousel__btn carousel__btn--prev" id="prevSlide" aria-label="Предыдущее фото">❮</button>
            <div class="carousel__container">
              <img src="${mainImage}" alt="${foundTour.title}" id="carouselImage" />
            </div>
            <button class="carousel__btn carousel__btn--next" id="nextSlide" aria-label="Следующее фото">❯</button>
            <div class="carousel__dots" id="carouselDots"></div>
          </div>
          <div class="tour-page__content">
            <h1 class="tour-page__title">${foundTour.title}</h1>
            <p class="tour-page__description">${(foundTour.info || "").replace(/\n/g, '<br>')}</p>
            <hr>
            <h3>Расписание:</h3>
            <p class="tour-page__schedule">${foundTour.schedule || "Уточняйте у менеджера"}</p>
            <button class="btn btn--primary" id="tourPageBookingBtn">Забронировать</button>
          </div>
        </div>
      `;

      // Рендерим
      tourSection.innerHTML = '';
      tourSection.appendChild(crumbs);

      const container = document.createElement('div');
      container.innerHTML = html;
      tourSection.appendChild(container);

      // Обработчик на кнопку "Забронировать"
      const bookingBtn = document.getElementById('tourPageBookingBtn');
      if (bookingBtn) {
        bookingBtn.addEventListener('click', () => {
          if (window.openBookingSidebar) {
            window.openBookingSidebar(foundTour.title);
          }
        });
      }

      // Карусель
      (function() {
        const tourImages = foundTour.images || ["images/placeholder.jpg"];
        let currentIndex = 0;
        const carouselImage = document.getElementById("carouselImage");
        const prevBtn = document.getElementById("prevSlide");
        const nextBtn = document.getElementById("nextSlide");
        const dotsContainer = document.getElementById("carouselDots");

        function updateCarousel() {
          carouselImage.src = tourImages[currentIndex];
          document.querySelectorAll(".carousel__dot").forEach(dot => dot.classList.remove("active"));
          dotsContainer.children[currentIndex].classList.add("active");
        }

        tourImages.forEach((_, index) => {
          const dot = document.createElement("span");
          dot.classList.add("carousel__dot");
          if (index === 0) dot.classList.add("active");
          dot.addEventListener("click", () => {
            currentIndex = index;
            updateCarousel();
          });
          dotsContainer.appendChild(dot);
        });

        prevBtn.addEventListener("click", () => {
          currentIndex = (currentIndex - 1 + tourImages.length) % tourImages.length;
          updateCarousel();
        });

        nextBtn.addEventListener("click", () => {
          currentIndex = (currentIndex + 1) % tourImages.length;
          updateCarousel();
        });

        updateCarousel();
      })();
    })();
  </script>
</body>
</html>